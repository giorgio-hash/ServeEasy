\documentclass[12pt,a4paper,openright,titlepage,twoside]{book}
\usepackage[T1]{fontenc} % codifica dei font
\usepackage[utf8]{inputenc} % lettere accentate da tastiera
% Includere pagine pdf (frontespizio)
\usepackage{pdfpages}
% tesi in italiano
\usepackage[italian]{babel}
% Margini: 3 cm sopra, sotto e sui lati 
\usepackage{geometry}
\geometry{a4paper,top=3cm,bottom=3cm,left=3cm,right=3cm,heightrounded}
% Interlinea 1.5
\usepackage{setspace}
\onehalfspacing
\raggedbottom
\usepackage{newtxtext,newtxmath}
% Numerazione pagine in basso a dx e sx e intestazione in alto
\usepackage{fancyhdr}
\pagestyle{fancy}
\renewcommand{\chaptermark}[1]{\markboth{\MakeUppercase{#1}}{}} %rimuovi l'enumerazione dei capitoli dall'intestazione
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\footrulewidth}{0pt}
\fancyhf{}
\fancyfoot[LE,RO]{\thepage}
\fancyhead[LE,RO]{\slshape \rightmark}
\fancyhead[LO,RE]{\slshape \leftmark}
%headheight
\setlength{\headheight}{14.49998pt}
%pacchetti per inserire pseudocodice iterazione 2
\usepackage{algorithm}
\usepackage[]{algpseudocode}
% Pagine bianche senza intestazione
\makeatletter
\def\cleardoublepage{\clearpage\if@twoside \ifodd\c@page\else
	\hbox{}
	\vspace*{\fill}
	\vspace{\fill}
	\thispagestyle{empty}
	\newpage
	\if@twocolumn\hbox{}\newpage\fi\fi\fi}
\makeatother
% sommario
\newenvironment{abstract}%
{\cleardoublepage%
	\thispagestyle{empty}% non rendo visibile la numerazione
	\null \vfill\begin{center}%
		\bfseries \abstractname \end{center}}%
{\vfill\null}
\providecommand{\abstract}{}
% Titoli
\usepackage{titlesec}
\titleformat{\chapter}[display]
{\normalfont\bfseries}{}{0pt}{\Huge}
\titlespacing*{\chapter}{0pt}{-50pt}{40pt}
% Bibliografia
\usepackage[autostyle, italian=guillemets]{csquotes}
\usepackage[backend=biber, style=numeric]{biblatex}
\usepackage{guit} 
\addbibresource{bibliography.bib}
% Riferimenti incrociati
\usepackage[italian]{varioref}
% citazioni
\usepackage{quoting}
\quotingsetup{font=small}
%commenti
\usepackage{comment}
% Acronimi
\usepackage[printonlyused,withpage]{acronym}
% Figure
\usepackage{graphicx}
\usepackage[nottoc]{tocbibind}
\usepackage{wrapfig}
\usepackage{float}
% math
\usepackage{amsmath}
% Didascalie
\usepackage[font=small,format=hang,labelfont={sf,bf}]{caption}
\usepackage{subcaption}
% tabelle
\usepackage{tabularx}
% Codice
%\usepackage{listings}
\usepackage{listings,xcolor}
\addto\captionsitalian{%
	\renewcommand{\lstlistingname}{Codice}
	\renewcommand{\lstlistlistingname}{Elenco dei codici}}
 % colori personalizzati
\definecolor{codeCommentGray}{rgb}{0.55,0.55,0.55}
\definecolor{codeNaturalColorSystem}{rgb}{0,0.48,0.65}
\definecolor{codeDarkMagenta}{rgb}{0.53,0.06,0.58}
\definecolor{codeMediumDarkblue}{rgb}{0,0.20,0.70}
\definecolor{codeOliveGreen}{rgb}{0.50,0.50,0}
\definecolor{codeNumberColor}{rgb}{0.09,0.31,0.92}
\definecolor{codeDarkGreen}{rgb}{0.02,0.49,0.09}
\definecolor{codeDarkyellow}{rgb}{0.69,0.6,0.12}
\definecolor{codeCyan}{rgb}{0.12,0.62,0.65}
% Definizione dei linguaggi:
% Definizione del linguaggio docker-compose
\lstdefinelanguage{docker-compose}{
    keywords={version, services, networks, volumes, image, ports, build, environment, command, 
    container_name, restart, ZOOKEEPER_CLIENT_PORT, ZOOKEEPER_TICK_TIME,
    depends_on, KAFKA_BROKER_ID, KAFKA_ZOOKEEPER_CONNECT, KAFKA_LISTENER_SECURITY_PROTOCOL_MAP,
    KAFKA_ADVERTISED_LISTENERS, KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR, KAFKA_TRANSACTION_STATE_LOG_MIN_ISR, KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR, KAFKA_BROKERCONNECT },
    keywordstyle=\color{codeMediumDarkblue}\bfseries,
    identifierstyle=\color{black},
    sensitive=false,
    comment=[l]{\#},
    commentstyle=\color{gray}\ttfamily,
    stringstyle=\color{codeDarkGreen}\ttfamily,
    morestring=[b]",
    morestring=[b]',
    escapechar={|@}, %parentesi di escape per applicare manualmente modifiche 
}
% Definizione del linguaggio YAML
\lstdefinelanguage{yaml}{
    keywords={true,false,null,y,n,
    spring, kafka, bootstrap, servers , producer, topic, group,id, consumer, auto, offset, reset, jpa, properties, hibernate, dialect, temp, use_jdbc_metadata_defaults, ddl, show, sql, datasource, url, username, password, driver, class, name, on, push, branches, pull_request, jobs, build,build-and-ship, image, tags, registry, dockerfile, runs, if, steps, uses, with, java, version, distribution, cache, run},
    keywordstyle=\color{codeMediumDarkblue}\bfseries,
    sensitive=true,
    comment=[l]{\#},
    commentstyle=\color{gray}\ttfamily,
    stringstyle=\color{codeDarkGreen}\ttfamily,
    escapechar={|}, %parentesi di escape per applicare manualmente modifiche 
}
% Definizione del linguaggio XML
\lstdefinelanguage{XML}{
    keywords={dependency,groupId,artifactId, scope, version},
    keywordstyle=\color{codeMediumDarkblue}\bfseries,
    sensitive=false,
    comment=[s]{<!--}{-->},
    commentstyle=\color{gray}\ttfamily,
    stringstyle=\color{codeDarkGreen}\ttfamily,
}
% Definizione del nuovo stile di codice per il terminale
\lstdefinestyle{terminal}{
    basicstyle=\footnotesize\ttfamily\color{white}, % Stile di base del testo (font terminale)
    backgroundcolor=\color{black}, % Colore di sfondo (nero)
    frame=single, % Cornice intorno al codice
    frameround=fttt, % Stile del bordo della cornice
    rulecolor=\color{gray}, % Colore della linea della cornice
    numberstyle=\tiny\color{gray}, % Stile dei numeri di riga (grigio)
    numbers=left, % Posizione dei numeri di riga (sinistra)
    breaklines=true, % Auto-interruzione delle linee lunghe
    showstringspaces=false, % Non mostrare spazi in stringhe
    captionpos=b, % Posizione della didascalia: sotto
    escapeinside={(*@}{@*)}, % Permette di utilizzare comandi LaTeX all'interno del codice
    extendedchars=true, % Abilita caratteri estesi
    literate=%
        {à}{{\`a}}1
        {è}{{\`e}}1
        {ì}{{\`i}}1
        {ò}{{\`o}}1
        {ù}{{\`u}}1
        {€}{{\euro{}}}1
        {°}{{\textdegree{}}}1
}
% Impostazioni per l'inclusione del codice
\lstset{
    basicstyle=\footnotesize\ttfamily, % Stile di base del testo
    numbers=left, % Numeri di riga a sinistra
    numberstyle=\tiny\color{gray}, % Stile dei numeri di riga
    stepnumber=1, % Passo tra i numeri di riga
    showstringspaces=false, % Non mostrare spazi in stringhe
    breaklines=true, % Auto-interruzione delle linee lunghe
    breakatwhitespace=false, % Interruzione solo negli spazi bianchi
    frame=lines, % linee intorno al codice
    backgroundcolor=\color{gray!5}, % Colore di sfondo del blocco di codice
    captionpos=b, % Posizione della didascalia: sotto
}
% Sovrascrittura delle impostazioni per il linguaggio AspectJ Java
\lstdefinestyle{myJava}{
    language=[AspectJ]Java,
    emph={@Configuration, @Value, @Bean, @Service, @Log, @Autowired, @Override, @BeforeEach, @Test, @EnableKafka, @SpringBootTest, @DirtiesContext, TestMethodOrder, @EmbeddedKafka, @TestMethodOrder, @KafkaListener, @Payload, @Header, @Data, @AllArgsConstructor, @NoArgsConstructor, @Builder, @Entity, @Table, @Id, @GeneratedValue, @Column, @Basic, @CreationTimestamp, @Repository, @ExtendWith, @Component, @GetMapping, @PostMapping, @RequestBody, @DeleteMapping, @PatchMapping, @RequestMapping, @RestController, @AutoConfigureMockMvc},
    emphstyle={\color{codeDarkyellow}},
    commentstyle=\color{codeCommentGray},
	keywordstyle=\color{codeMediumDarkblue},
	stringstyle=\color{codeDarkGreen},
	basicstyle=\ttfamily\footnotesize,
	keepspaces=true,                 
	numbersep=5pt,                  
	showspaces=false,                
	showstringspaces=false,
	showtabs=false,                  
	tabsize=2,
}
\lstdefinestyle{sqlstyle}{
    language=SQL, % Impostazione del linguaggio SQL
    basicstyle=\footnotesize\ttfamily, % Stile di base del testo
    commentstyle=\color{gray}, % Stile dei commenti (grigio)
    keywordstyle=\color{blue}, % Stile delle parole chiave (blu)
    stringstyle=\color{red}, % Stile delle stringhe (rosso)
}
\lstdefinestyle{pythonstyle}{
	language=Python, % Impostazione del linguaggio Python
	basicstyle=\footnotesize\ttfamily, % Stile di base del testo
	commentstyle=\color{gray}, % Stile dei commenti (grigio)
	keywordstyle=\color{codeMediumDarkblue}, % Stile delle parole chiave (blu)
	stringstyle=\color{codeDarkGreen}, % Stile delle stringhe (rosso)
}
\lstset{moredelim=[is][\color{codeNaturalColorSystem}]{|*}{*|}}
\lstset{moredelim=[is][\color{codeNumberColor}]{?*}{*?}}
\lstset{moredelim=[is][\color{black}]{!*}{*!}}

%colori personalizzati per Docker
\lstdefinelanguage{Dockerfile}{
  keywords={FROM, RUN, CMD, LABEL, MAINTAINER, EXPOSE, ENV, ADD, COPY, ENTRYPOINT, VOLUME, USER, WORKDIR, ARG, ONBUILD, STOPSIGNAL, HEALTHCHECK, SHELL},
  keywordstyle=\color{red}\bfseries,
  identifierstyle=\color{black},
  sensitive=false,
  comment=[l]{\#},
  commentstyle=\color{green}\ttfamily,
  stringstyle=\color{blue}\ttfamily,
  morestring=[b]',
  morestring=[b]"
}


% Collegamenti ipertestuali e al Web
\usepackage[colorlinks]{hyperref} % sempre per ultimo
\hypersetup{
	colorlinks=true,
	linkcolor=black,
	filecolor=magenta,      
	urlcolor=cyan,
}
%\hypersetup{hidelinks}


\begin{document}
	
	\frontmatter	
	\input{resources/Frontespizio}
%	\input{inizio/sommario}
	\mainmatter				
	\tableofcontents	% indice generale
	\listoffigures		% indice delle figure
	\lstlistoflistings  %indice del codice
	\addcontentsline{toc}{chapter}{Elenco dei codici}
	\chapter{Iterazione 0}
	\input{iterazione0/introduzione}
	\input{iterazione0/requisiti_funzionali}
	\input{iterazione0/requisiti_non_funzionali}
	\input{iterazione0/topologia}
	\input{iterazione0/toolchain}
	\chapter{Iterazione 1}
	\input{iterazione1/introduzione}
	\input{iterazione1/use_cases}
	\input{iterazione1/component_diagram}
	\input{iterazione1/database}
    \input{iterazione1/deployment_diagram}
    \input{iterazione1/interface_class_diagram}
    \input{iterazione1/organizzazione}
    \input{iterazione1/costruzione_scheletro}
    \input{iterazione1/deployment}
    \input{iterazione1/api}
    \input{iterazione1/analisi_statica}
    \chapter{Iterazione 2}
    \input{iterazione2/introduzione}
    \input{iterazione2/organizzazione}
    \input{iterazione2/funzionedipriorita}
	\input{iterazione2/pseudocodice}
	\input{iterazione2/strutturadati}
	\input{iterazione2/diagrammadiflusso}
	\chapter{Iterazione 3}
	\input{iterazione3/introduzione}
    \input{iterazione3/gateway}
	\input{iterazione3/algoritmo}
	\input{iterazione3/analisi_dati}
    \nocite{*}
    \printbibliography
	\backmatter	
 
\end{document}